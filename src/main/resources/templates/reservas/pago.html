<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pago de Reserva - Club Social y Deportivo Maracaná</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.2/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/webjars/font-awesome/6.4.0/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div th:replace="fragments/header :: header"></div>
    
    <main class="container my-5">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">Pago de Reserva</h4>
            </div>
            <div class="card-body">
                <div class="progress mb-4">
                    <div class="progress-bar bg-success" role="progressbar" 
                         th:style="'width: ' + (${paso} * 25) + '%'" 
                         th:aria-valuenow="${paso * 25}" 
                         aria-valuemin="0" aria-valuemax="100">
                        Paso <span th:text="${paso}"></span> de 4
                    </div>
                </div>
                
                <div class="step-content">
                    <h5 class="card-title">Paso 4: Confirma y Paga tu Reserva</h5>
                    
                    <!-- Resumen de la reserva -->
                    <div class="card mb-4 bg-light">
                        <div class="card-header">
                            <h6 class="mb-0">Resumen de tu reserva</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><strong>Fecha:</strong> <span th:text="${#temporals.format(reservaDTO.fechaReserva, 'dd/MM/yyyy')}">01/01/2023</span></li>
                                        <li><strong>Hora:</strong> <span th:text="${reservaDTO.horaReserva}">07:00</span></li>
                                        <li><strong>Cancha:</strong> <span th:text="${reservaDTO.canchaId}">C1</span></li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <div class="alert alert-primary">
                                        <h4 class="alert-heading">Valor a pagar</h4>
                                        <h2 class="text-center">$160.000 COP</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formulario de pago -->
                    <form th:action="@{/reservas/nueva/procesar-pago}" method="post" id="pagoForm">
                        <!-- Campos ocultos para la reserva -->
                        <input type="hidden" name="fechaReserva" th:value="${reservaDTO.fechaReserva}">
                        <input type="hidden" name="horaReserva" th:value="${reservaDTO.horaReserva}">
                        <input type="hidden" name="canchaId" th:value="${reservaDTO.canchaId}">
                        
                        <!-- Campos ocultos para el pago -->
                        <input type="hidden" name="monto" value="160000.00">
                        
                        <div class="mb-4">
                            <label for="metodoPago" class="form-label">Método de Pago</label>
                            <select id="metodoPago" name="metodoPago" class="form-select" required>
                                <option value="">Seleccione un método de pago...</option>
                                <option th:each="metodo : ${metodosPago}" 
                                        th:value="${metodo.name()}" 
                                        th:text="${metodo.name()}">EFECTIVO</option>
                            </select>
                            <div class="form-text">Este es un proceso de pago ficticio para fines de demostración.</div>
                        </div>
                        
                        <!-- Información de pago ficticia -->
                        <div class="card mb-4 border-dashed">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-3 text-muted">Información del pago</h6>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Este es un proceso de pago simulado para fines educativos. 
                                    No se realizará ningún cargo real a tu tarjeta o cuenta bancaria.
                                </div>
                                
                                <div class="mb-3">
                                    <label for="titular" class="form-label">Titular de la cuenta/tarjeta</label>
                                    <input type="text" class="form-control" id="titular" value="DEMOSTRACIÓN" readonly>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="numeroTarjeta" class="form-label">Número de tarjeta (ficticio)</label>
                                    <input type="text" class="form-control" id="numeroTarjeta" value="**** **** **** 1234" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mensaje de error -->
                        <div th:if="${error}" class="alert alert-danger mb-4" th:text="${error}"></div>
                        
                        <div class="d-flex justify-content-between">
                            <a th:href="@{/reservas/nueva/paso2}" class="btn btn-outline-secondary">Anterior</a>
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-check-circle me-2"></i>Confirmar y Pagar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
    
    <div th:replace="fragments/footer :: footer"></div>
    
    <script th:src="@{/webjars/jquery/3.6.4/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>
    <script>
        $(document).ready(function() {
            // Validación del formulario de pago
            $("#pagoForm").submit(function(event) {
                console.log("Formulario de pago enviado");
                
                // Validar que el método de pago esté seleccionado
                if (!$("#metodoPago").val()) {
                    alert("Por favor, selecciona un método de pago");
                    event.preventDefault();
                    return false;
                }
                
                // Mostrar mensaje de procesamiento
                $(this).find("button[type=submit]").prop("disabled", true)
                    .html('<i class="fas fa-spinner fa-spin me-2"></i>Procesando pago...');
                
                // Si todo está bien, permitimos que el formulario se envíe normalmente
            });
        });
    </script>
</body>
</html>
